<% layout("/layouts/boilerplate") -%>

<script>
  const mapToken = "<%= process.env.MAP_TOKEN %>";
  const listing = <%- JSON.stringify(listing) %>;
</script>

<div class="row mt-4 mb-5">
  <div class="col-md-6 mx-auto">
    <h3><b><%= listing.title %> &#128651</b></h3>
    <h5><i>Owned By: <%= listing.owner.username %></i></h5>
    <div class="card col-md-8 show-card listing-card">
      <img src="<%=listing.image.url%>" class="card-img-top" style="height:400px;" alt="..." />
    </div>

    <ul>
      <li><%= listing.description %></li>
      <li>&#8377; <%= listing.price.toLocaleString("en-IN") %></li>
      <li><%= listing.location %></li>
      <li><%= listing.country %></li>
    </ul>
    <br />
    <div class="btns mb-5">
      <a class="btn btn-dark edit-btn" href="/listings/<%= listing._id %>/edit">Edit</a>
      <form
        method="POST"
        action="/listings/<%=listing._id%>?_method=DELETE"
        style="display: inline">
        <button class="btn btn-outline-danger offset-1">Delete</button>
      </form>
    </div>
  </div>

  <div class="col-md-6 mx-auto">
    <div class="row">
      
      <%if(currUser){%>
        <form class="col-md-8 mx-auto" action="/listings/<%=listing.id%>/review" method="POST" novalidate class="needs-validation">
          <h4 class="mb-4">Leave a Review &#11088</h4>  
          <div class="col-3">
            
            <fieldset class="starability-slot">
              <input type="radio" id="no-rate" class="input-no-rate" name="review[rating]" value="1" checked aria-label="No rating." />
              <input type="radio" id="first-rate1" name="review[rating]" value="1" />
              <label for="first-rate1" title="Terrible">1 star</label>
              <input type="radio" id="first-rate2" name="review[rating]" value="2" />
              <label for="first-rate2" title="Not good">2 stars</label>
              <input type="radio" id="first-rate3" name="review[rating]" value="3" />
              <label for="first-rate3" title="Average">3 stars</label>
              <input type="radio" id="first-rate4" name="review[rating]" value="4" />
              <label for="first-rate4" title="Very good">4 stars</label>
              <input type="radio" id="first-rate5" name="review[rating]" value="5" />
              <label for="first-rate5" title="Amazing">5 stars</label>
            </fieldset>

          </div>
      
          <div class="form-floating col-9">
            <textarea name="review[comment]" class="form-control" placeholder="Leave a review here" id="floatingTextarea2" style="height: 100px;" required></textarea>
            <label for="floatingTextarea2">Comment:</label>
      
            <div class="invalid-feedback">
              Please submit your feedback
            </div>
          </div>
      
          <button class="btn btn-success mt-4">Submit</button>
        </form>
      <%}%>
    </div>

    <%if(listing.reviews.length > 0){%>
      <div class="row mt-5">
        <h4 class="col-md-8 mx-auto">All reviews &#128513;</h4>
      
        <% for(review of listing.reviews){ %>
          <div class="card col-md-8 mx-auto mb-3">
            <div class="card-body mb-2">
              <h5 class="card-title"><%=review.comment%></h5>
              <p class="starability-result" data-rating="<%=review.rating%>"></p>
              <div class="d-flex">
                <form method="POST" action="/listings/<%=listing._id%>/review/<%=review._id%>?_method=DELETE">
                  <button class="btn btn-outline-dark">Delete</button>
                </form>
                <p class="offset-6">Author: <%=review.author.username%></p>
              </div>
            </div>
          </div>
        <%}%>
      </div>
    <%}%>

   <div class="row mt-5">
    <h3 class="col-md-8 mx-auto">Where you'll be</h3>
    <div id="map"></div>
   </div>
      
  </div>
</div>

<script src="/js/map.js"></script>